local M = {}
local sfx = require("scripts.sfx")

local clockParts = {
	["menu"] = {
		{0,0,149.17828430524,15.679269490148,150,0},
		{0,0,146.72214011007,31.186753622664,149.17828430524,15.679269490148},
		{0,0,142.65847744427,46.352549156242,146.72214011007,31.186753622664},
		{0,0,137.03181864639,61.01049646137,142.65847744427,46.352549156242},
		{0,0,129.90381056767,75,137.03181864639,61.01049646137},
		{0,0,121.35254915624,88.167787843871,129.90381056767,75},
		{0,0,111.47172382161,100.36959095383,121.35254915624,88.167787843871},
		{0,0,100.36959095383,111.47172382161,111.47172382161,100.36959095383},
		{0,0,88.167787843871,121.35254915624,100.36959095383,111.47172382161},
		{0,0,75,129.90381056767,88.167787843871,121.35254915624},
		{0,0,61.01049646137,137.03181864639,75,129.90381056767},
		{0,0,46.352549156242,142.65847744427,61.01049646137,137.03181864639},
		{0,0,31.186753622664,146.72214011007,46.352549156242,142.65847744427},
		{0,0,15.679269490148,149.17828430524,31.186753622664,146.72214011007},
		{0,0,4.249154173236e-14,150,15.679269490148,149.17828430524},
		{0,0,-15.679269490148,149.17828430524,4.249154173236e-14,150},
		{0,0,-31.186753622664,146.72214011007,-15.679269490148,149.17828430524},
		{0,0,-46.352549156242,142.65847744427,-31.186753622664,146.72214011007},
		{0,0,-61.01049646137,137.03181864639,-46.352549156242,142.65847744427},
		{0,0,-75,129.90381056767,-61.01049646137,137.03181864639},
		{0,0,-88.167787843871,121.35254915624,-75,129.90381056767},
		{0,0,-100.36959095383,111.47172382161,-88.167787843871,121.35254915624},
		{0,0,-111.47172382161,100.36959095383,-100.36959095383,111.47172382161},
		{0,0,-121.35254915624,88.167787843871,-111.47172382161,100.36959095383},
		{0,0,-129.90381056767,75,-121.35254915624,88.167787843871},
		{0,0,-137.03181864639,61.01049646137,-129.90381056767,75},
		{0,0,-142.65847744427,46.352549156242,-137.03181864639,61.01049646137},
		{0,0,-146.72214011007,31.186753622664,-142.65847744427,46.352549156242},
		{0,0,-149.17828430524,15.679269490148,-146.72214011007,31.186753622664},
		{0,0,-150,-1.1485706096781e-13,-149.17828430524,15.679269490148},
		{0,0,-149.17828430524,-15.679269490148,-150,-1.1485706096781e-13},
		{0,0,-146.72214011007,-31.186753622664,-149.17828430524,-15.679269490148},
		{0,0,-142.65847744427,-46.352549156242,-146.72214011007,-31.186753622664},
		{0,0,-137.03181864639,-61.01049646137,-142.65847744427,-46.352549156242},
		{0,0,-129.90381056767,-75,-137.03181864639,-61.01049646137},
		{0,0,-121.35254915624,-88.167787843871,-129.90381056767,-75},
		{0,0,-111.47172382161,-100.36959095383,-121.35254915624,-88.167787843871},
		{0,0,-100.36959095383,-111.47172382161,-111.47172382161,-100.36959095383},
		{0,0,-88.167787843871,-121.35254915624,-100.36959095383,-111.47172382161},
		{0,0,-75,-129.90381056767,-88.167787843871,-121.35254915624},
		{0,0,-61.01049646137,-137.03181864639,-75,-129.90381056767},
		{0,0,-46.352549156242,-142.65847744427,-61.01049646137,-137.03181864639},
		{0,0,-31.186753622664,-146.72214011007,-46.352549156242,-142.65847744427},
		{0,0,-15.679269490148,-149.17828430524,-31.186753622664,-146.72214011007},
		{0,0,-2.7554552980815e-14,-150,-15.679269490148,-149.17828430524},
		{0,0,15.679269490148,-149.17828430524,-2.7554552980815e-14,-150},
		{0,0,31.186753622664,-146.72214011007,15.679269490148,-149.17828430524},
		{0,0,46.352549156242,-142.65847744427,31.186753622664,-146.72214011007},
		{0,0,61.01049646137,-137.03181864639,46.352549156242,-142.65847744427},
		{0,0,75,-129.90381056767,61.01049646137,-137.03181864639},
		{0,0,88.167787843871,-121.35254915624,75,-129.90381056767},
		{0,0,100.36959095383,-111.47172382161,88.167787843871,-121.35254915624},
		{0,0,111.47172382161,-100.36959095383,100.36959095383,-111.47172382161},
		{0,0,121.35254915624,-88.167787843871,111.47172382161,-100.36959095383},
		{0,0,129.90381056767,-75,121.35254915624,-88.167787843871},
		{0,0,137.03181864639,-61.010496461371,129.90381056767,-75},
		{0,0,142.65847744427,-46.352549156243,137.03181864639,-61.010496461371},
		{0,0,146.72214011007,-31.186753622665,142.65847744427,-46.352549156243},
		{0,0,149.17828430524,-15.679269490149,146.72214011007,-31.186753622665},
		{0,0,150,0,149.17828430524,-15.679269490149},
	},
	["game"] = {
		{0,0,31.824700651785,3.3449108245649,32,0},
		{0,0,31.300723223482,6.6531741061683,31.824700651785,3.3449108245649},
		{0,0,30.433808521445,9.8885438199983,31.300723223482,6.6531741061683},
		{0,0,29.233454644563,13.015572578426,30.433808521445,9.8885438199983},
		{0,0,27.712812921102,16,29.233454644563,13.015572578426},
		{0,0,25.888543819998,18.809128073359,27.712812921102,16},
		{0,0,23.780634415277,21.412179403483,25.888543819998,18.809128073359},
		{0,0,21.412179403483,23.780634415277,23.780634415277,21.412179403483},
		{0,0,18.809128073359,25.888543819998,21.412179403483,23.780634415277},
		{0,0,16,27.712812921102,18.809128073359,25.888543819998},
		{0,0,13.015572578426,29.233454644563,16,27.712812921102},
		{0,0,9.8885438199983,30.433808521445,13.015572578426,29.233454644563},
		{0,0,6.6531741061683,31.300723223482,9.8885438199983,30.433808521445},
		{0,0,3.3449108245649,31.824700651785,6.6531741061683,31.300723223482},
		{0,0,9.0648622362368e-15,32,3.3449108245649,31.824700651785},
		{0,0,-3.3449108245649,31.824700651785,9.0648622362368e-15,32},
		{0,0,-6.6531741061683,31.300723223482,-3.3449108245649,31.824700651785},
		{0,0,-9.8885438199983,30.433808521445,-6.6531741061683,31.300723223482},
		{0,0,-13.015572578426,29.233454644563,-9.8885438199983,30.433808521445},
		{0,0,-16,27.712812921102,-13.015572578426,29.233454644563},
		{0,0,-18.809128073359,25.888543819998,-16,27.712812921102},
		{0,0,-21.412179403483,23.780634415277,-18.809128073359,25.888543819998},
		{0,0,-23.780634415277,21.412179403483,-21.412179403483,23.780634415277},
		{0,0,-25.888543819998,18.809128073359,-23.780634415277,21.412179403483},
		{0,0,-27.712812921102,16,-25.888543819998,18.809128073359},
		{0,0,-29.233454644563,13.015572578426,-27.712812921102,16},
		{0,0,-30.433808521445,9.8885438199983,-29.233454644563,13.015572578426},
		{0,0,-31.300723223482,6.6531741061683,-30.433808521445,9.8885438199983},
		{0,0,-31.824700651785,3.3449108245649,-31.300723223482,6.6531741061683},
		{0,0,-32,-2.4502839673132e-14,-31.824700651785,3.3449108245649},
		{0,0,-31.824700651785,-3.3449108245649,-32,-2.4502839673132e-14},
		{0,0,-31.300723223482,-6.6531741061683,-31.824700651785,-3.3449108245649},
		{0,0,-30.433808521445,-9.8885438199984,-31.300723223482,-6.6531741061683},
		{0,0,-29.233454644563,-13.015572578426,-30.433808521445,-9.8885438199984},
		{0,0,-27.712812921102,-16,-29.233454644563,-13.015572578426},
		{0,0,-25.888543819998,-18.809128073359,-27.712812921102,-16},
		{0,0,-23.780634415277,-21.412179403484,-25.888543819998,-18.809128073359},
		{0,0,-21.412179403483,-23.780634415277,-23.780634415277,-21.412179403484},
		{0,0,-18.809128073359,-25.888543819998,-21.412179403483,-23.780634415277},
		{0,0,-16,-27.712812921102,-18.809128073359,-25.888543819998},
		{0,0,-13.015572578426,-29.233454644563,-16,-27.712812921102},
		{0,0,-9.8885438199983,-30.433808521445,-13.015572578426,-29.233454644563},
		{0,0,-6.6531741061683,-31.300723223482,-9.8885438199983,-30.433808521445},
		{0,0,-3.3449108245649,-31.824700651785,-6.6531741061683,-31.300723223482},
		{0,0,-5.8783046359073e-15,-32,-3.3449108245649,-31.824700651785},
		{0,0,3.3449108245649,-31.824700651785,-5.8783046359073e-15,-32},
		{0,0,6.6531741061683,-31.300723223482,3.3449108245649,-31.824700651785},
		{0,0,9.8885438199983,-30.433808521445,6.6531741061683,-31.300723223482},
		{0,0,13.015572578426,-29.233454644563,9.8885438199983,-30.433808521445},
		{0,0,16,-27.712812921102,13.015572578426,-29.233454644563},
		{0,0,18.809128073359,-25.888543819998,16,-27.712812921102},
		{0,0,21.412179403483,-23.780634415277,18.809128073359,-25.888543819998},
		{0,0,23.780634415277,-21.412179403484,21.412179403483,-23.780634415277},
		{0,0,25.888543819998,-18.809128073359,23.780634415277,-21.412179403484},
		{0,0,27.712812921102,-16,25.888543819998,-18.809128073359},
		{0,0,29.233454644563,-13.015572578426,27.712812921102,-16},
		{0,0,30.433808521445,-9.8885438199984,29.233454644563,-13.015572578426},
		{0,0,31.300723223482,-6.6531741061684,30.433808521445,-9.8885438199984},
		{0,0,31.824700651785,-3.3449108245651,31.300723223482,-6.6531741061684},
		{0,0,32,0,31.824700651785,-3.3449108245651},
	}
}

local clockPartsXY = {
	["menu"] = {
		{75,7.839634745074},
		{74.58914215262,15.593376811332},
		{73.361070055035,23.176274578121},
		{71.329238722137,30.505248230685},
		{68.515909323195,37.5},
		{64.951905283833,44.083893921935},
		{60.676274578121,50.184795476914},
		{55.735861910805,55.735861910805},
		{50.184795476914,60.676274578121},
		{44.083893921935,64.951905283833},
		{37.5,68.515909323195},
		{30.505248230685,71.329238722137},
		{23.176274578121,73.361070055035},
		{15.593376811332,74.58914215262},
		{7.839634745074,75},
		{-7.839634745074,75},
		{-15.593376811332,74.589142152621},
		{-23.176274578121,73.361070055035},
		{-30.505248230685,71.329238722137},
		{-37.5,68.515909323195},
		{-44.083893921935,64.951905283833},
		{-50.184795476914,60.676274578121},
		{-55.735861910805,55.735861910805},
		{-60.676274578121,50.184795476914},
		{-64.951905283833,44.083893921935},
		{-68.515909323195,37.5},
		{-71.329238722137,30.505248230685},
		{-73.361070055035,23.176274578121},
		{-74.589142152621,15.593376811332},
		{-75,7.8396347450739},
		{-75,-7.8396347450741},
		{-74.58914215262,-15.593376811332},
		{-73.361070055035,-23.176274578121},
		{-71.329238722136,-30.505248230685},
		{-68.515909323195,-37.5},
		{-64.951905283833,-44.083893921936},
		{-60.676274578121,-50.184795476914},
		{-55.735861910804,-55.735861910805},
		{-50.184795476914,-60.676274578121},
		{-44.083893921935,-64.951905283833},
		{-37.5,-68.515909323195},
		{-30.505248230685,-71.329238722137},
		{-23.176274578121,-73.361070055035},
		{-15.593376811332,-74.589142152621},
		{-7.839634745074,-75},
		{7.839634745074,-75},
		{15.593376811332,-74.589142152621},
		{23.176274578121,-73.361070055035},
		{30.505248230685,-71.329238722137},
		{37.5,-68.515909323195},
		{44.083893921935,-64.951905283833},
		{50.184795476914,-60.676274578121},
		{55.735861910804,-55.735861910805},
		{60.676274578121,-50.184795476915},
		{64.951905283833,-44.083893921936},
		{68.515909323195,-37.5},
		{71.329238722136,-30.505248230685},
		{73.361070055035,-23.176274578121},
		{74.58914215262,-15.593376811332},
		{75,-7.8396347450743},
	},
	["game"] = {
		{16,1.6724554122825},
		{15.912350325892,3.3265870530841},
		{15.650361611741,4.9442719099992},
		{15.216904260722,6.5077862892128},
		{14.616727322282,8},
		{13.856406460551,9.4045640366796},
		{12.944271909999,10.706089701742},
		{11.890317207638,11.890317207638},
		{10.706089701742,12.944271909999},
		{9.4045640366796,13.856406460551},
		{8,14.616727322282},
		{6.5077862892128,15.216904260722},
		{4.9442719099992,15.650361611741},
		{3.3265870530842,15.912350325892},
		{1.6724554122825,16},
		{-1.6724554122824,16},
		{-3.3265870530841,15.912350325892},
		{-4.9442719099992,15.650361611741},
		{-6.5077862892128,15.216904260722},
		{-8,14.616727322282},
		{-9.4045640366796,13.856406460551},
		{-10.706089701742,12.944271909999},
		{-11.890317207638,11.890317207638},
		{-12.944271909999,10.706089701742},
		{-13.856406460551,9.4045640366796},
		{-14.616727322282,8},
		{-15.216904260722,6.5077862892128},
		{-15.650361611741,4.9442719099992},
		{-15.912350325892,3.3265870530841},
		{-16,1.6724554122824},
		{-16,-1.6724554122825},
		{-15.912350325892,-3.3265870530842},
		{-15.650361611741,-4.9442719099992},
		{-15.216904260722,-6.5077862892128},
		{-14.616727322282,-8},
		{-13.856406460551,-9.4045640366796},
		{-12.944271909999,-10.706089701742},
		{-11.890317207638,-11.890317207638},
		{-10.706089701742,-12.944271909999},
		{-9.4045640366795,-13.856406460551},
		{-8,-14.616727322282},
		{-6.5077862892128,-15.216904260722},
		{-4.9442719099991,-15.650361611741},
		{-3.3265870530841,-15.912350325892},
		{-1.6724554122825,-16},
		{1.6724554122824,-16},
		{3.3265870530841,-15.912350325892},
		{4.9442719099991,-15.650361611741},
		{6.5077862892128,-15.216904260722},
		{8,-14.616727322282},
		{9.4045640366795,-13.856406460551},
		{10.706089701742,-12.944271909999},
		{11.890317207638,-11.890317207638},
		{12.944271909999,-10.706089701742},
		{13.856406460551,-9.4045640366796},
		{14.616727322282,-8},
		{15.216904260722,-6.5077862892129},
		{15.650361611741,-4.9442719099992},
		{15.912350325892,-3.3265870530842},
		{16,-1.6724554122825},
	}
}

local _newPolygon = display.newPolygon
local _unpack = unpack

function M.create( group, x, y, scene )
	local clock = display.newGroup()
	clock.x, clock.y = x, y
	group:insert( clock )
	clock.isStopped = true
	
	for i = 1, #clockParts[scene] do
		clock[i] = _newPolygon( clock, clockPartsXY[scene][i][1], clockPartsXY[scene][i][2], { _unpack( clockParts[scene][i] ) } )
		clock[i]:setFillColor(0.95)
	end
	clock:rotate(-90)
	
	if scene == "game" then
		clock.hand = display.newImageRect( clock, "images/clockhand.png", 30, 8 )
		clock.centre = display.newCircle( clock, 0, 0, 2 )
	else
		clock.hand = display.newImageRect( clock, "images/clockhand.png", 120, 32 )
		clock.centre = display.newCircle( clock, 0, 0, 10 )
	end
	clock.hand.anchorX = 0
	
	clock.centre.fill.effect = "generator.radialGradient"
	clock.centre.fill.effect.color1 = { 0.2, 0.2, 0.2, 1 }
	clock.centre.fill.effect.color2 = { 0.05, 0.05, 0.05, 1 }
	clock.centre.fill.effect.center_and_radiuses  =  { 0.5, 0.5, 0.25, 0.75 }
	clock.centre.fill.effect.aspectRatio  = 1
	
	local callback
	
	local listener = {}
	function listener:timer( event )
		clock[event.count].isVisible = false
		clock.hand:rotate(6)
		if event.count == 60 then
			clock.isStopped = true
			clock.handle = nil
			if callback then callback() end
		end
	end
	
	function clock:start( func )
		callback = func
		clock.hand.rotation = 0
		for i = 1, 60 do
			clock[i].isVisible = true
		end
        sfx.startBG( sfx.bg )
		clock.isStopped = false
		self.handle = timer.performWithDelay( 990, listener, 60 )
	end
	
	function clock:stop()
		if self.handle then
			timer.cancel( self.handle )
			self.handle = nil
		end
		clock.isStopped = true
		sfx.stopBG()
	end
	
	return clock
end

return M